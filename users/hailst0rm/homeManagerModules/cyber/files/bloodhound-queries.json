{
  "queries": [
    {
      "category": "AWS",
      "name": "Find all GROUPS that contain 'AWS' or 'AMAZON' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n) WHERE (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*(aws|amazon).*' OR n.azname =~ '(?i).*(aws|amazon).*') RETURN n"
        }
      ]
    },
    {
      "category": "AWS",
      "name": "Find all USERS that are members of groups containing 'AWS' or 'AMAZON' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m)-[MemberOf*1..]->(n) WHERE (m:User OR m:AZUser) AND (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*(aws|amazon).*' OR n.azname =~ '(?i).*(aws|amazon).*') RETURN p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "All Computers Local Admin to Another Computer",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (c1:Computer)-[r1:AdminTo]->(c2:Computer) RETURN p UNION ALL MATCH p = (c3:Computer)-[r2:MemberOf|HasSIDHistory*1..]->(g:Group)-[r3:AdminTo]->(c4:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "All Computers in Domain Admins",
      "queryList": [
        {
          "final": false,
          "title": "Select a Domain Admins group...",
          "query": "MATCH (g:Group) WHERE g.objectid =~ $domain_admins_id RETURN g.name ORDER BY g.name ASC",
          "props": {
            "domain_admins_id": "S-1-5-.*-512"
          }
        },
        {
          "final": true,
          "query": "MATCH p = (c:Computer)-[r:MemberOf|HasSIDHistory*1..]->(g:Group) WHERE g.name = $result RETURN p",
          "endNode": "{}"
        }
      ]
    },
    {
      "name": "Computers with administrative Domain Users",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:AddMember|AdminTo|AllExtendedRights|AllowedToDelegate|CanRDP|Contains|ExecuteDCOM|ForceChangePassword|GenericAll|GenericWrite|GetChanges|GetChangesAll|HasSession|Owns|ReadLAPSPassword|SQLAdmin|TrustedBy|WriteDACL|WriteOwner|AddAllowedToAct|AllowedToAct]->(t) WHERE m.objectsid ENDS WITH '-513' OR m.objectsid ENDS WITH '-515' OR m.objectsid ENDS WITH 'S-1-5-11' OR m.objectsid ENDS WITH 'S-1-1-0' RETURN p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "Find all active Domain Admin sessions",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:User)-[:MemberOf]->(g:Group) WHERE g.objectid ENDS WITH '-512' MATCH p = (c:Computer)-[:HasSession]->(n) return p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "Find all owned users that have local admin rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((m:User {owned: True})-[r:HasSession|AdminTo|MemberOf*1..]->(n:Computer)) RETURN p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "Find all users that have direct local admin rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:User)-[r:AdminTo]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "name": "Find all users that have local admin rights or Groups (Warning Can Be Heavy)",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:User)-[r:AdminTo|MemberOf*1..]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Admin Hunter",
      "name": "Find groups that have local admin rights (Warning: Heavy)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:AdminTo]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "name": "Find groups that have local admin rights (Warning: Heavy)",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:AdminTo]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "name": "Privileged Service Account Risk",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User)-[:MemberOf*1..]->(g:Group) WHERE g.highvalue = true AND u.serviceprincipalnames IS NOT NULL AND u.pwdlastset < (datetime().epochseconds - (365 * 86400)) RETURN u.name, u.serviceprincipalnames, u.pwdlastset"
        }
      ]
    },
    {
      "name": "Shadow Admin Detection",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE NOT (u)-[:MemberOf*1..]->(:Group {name:'DOMAIN ADMINS@DOMAIN.COM'}) WITH u MATCH p=(u)-[:GenericAll|WriteDacl|WriteOwner|ExecuteDCOM|GenericWrite|AllExtendedRights|ForceChangePassword]->(:Computer) RETURN u.name, COUNT(p) as admin_rights_count ORDER BY admin_rights_count DESC"
        }
      ]
    },
    {
      "name": "Users with most local admin rights",
      "category": "Admin Hunter",
      "queryList": [
        {
          "final": true,
          "requireNodeSelect": false,
          "query": "MATCH (U:User)-[r:MemberOf|AdminTo*1..]->(C:Computer) WITH U.name as n, COUNT(DISTINCT(C)) AS c RETURN n,c ORDER BY c DESC LIMIT 5",
          "allowCollapse": true,
          "props": {}
        }
      ]
    },
    {
      "category": "Azure",
      "name": "All Owned Principals",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (o) WHERE o.owned = true RETURN o"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Ensure Azure relationships are flagged with 'isazure' property",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=()-[r:AZAvereContributor|AZContains|AZContributor|AZGetCertificates|AZGetKeys|AZGetSecrets|AZHasRole|AZMemberOf|AZOwner|AZRunsAs|AZVMContributor|AZAddMembers|AZAddSecret|AZExecuteCommand|AZGlobalAdmin|AZGrant|AZGrantSelf|AZPrivilegedRoleAdmin|AZAZResetPassword|AZUserAccessAdministrator]->() SET r.isazure = true RETURN p LIMIT 25"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find All edges any owned user has on a device, vm, app, keyvault etc.",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((m:AZUser {owned: True})-[r*]->(b)) WHERE NOT m=b AND (b:AZDevice OR b:AZVM OR b:AZApp OR b:AZKeyVault OR b:AZFunctionApp OR b:AZTenant OR b:AZSubscription OR b:AZResourceGroup OR b:AZWorkflow) RETURN p"
        }
      ]
    },
    {
      "name": "Find Azure users with MFA disabled who have privileged roles",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:AZUser)-[:AZMemberOf|AZHasRole*1..]->(r:AZRole) WHERE r.isPrivileged = true AND u.mfaenabled = false RETURN u.name, u.userprincipalname, r.name"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all Owners of Azure Applications",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all Owners of Azure VMs",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (n)-[r:AZOwns]->(g:AZVMs) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all Privileged Service Principals",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all paths to an Azure KeyVault",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all shortest paths to an Azure KeyVault",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((n)-[r]->(g:AZKeyVault)) WHERE NOT n=g RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Find all shortest paths to an Azure VM",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((n)-[r*1..]->(g:AZVM)) WHERE NOT n=g RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List All High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m {highvalue: True}) OPTIONAL MATCH (m)-[r:AZMemberOf|AZHasRole|AZOwns]-(n {highvalue: true}) RETURN m, n, r"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Apps (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:AZApp) RETURN n LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Devices (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZDevice) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Groups (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZGroup) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Key Vaults (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZKeyVault) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Resource Groups (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZResourceGroup) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Service Principals (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZServicePrincipal) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Tenants (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZTenant) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure Users (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZUser) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure VMs (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZVM) RETURN m LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List Azure roles that can reset password",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n)-[]-(m) WHERE (tolower(n.templateid)) IN ['c4e39bd9-1100-46d3-8c65-fb160da0071f', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', '729827e3-9c14-49f7-bb1b-9608f156bbb8', 'fe930be7-5e62-47db-91af-98c3a49a38b1', '966707d0-3269-4727-9be2-8c3a10f19b9d'] RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List all owned devices",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZDevice {owned: True}) OPTIONAL MATCH (g)-[r:AZContains*1..]->(m) RETURN m, r, g"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List all owned groups",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZGroup {owned: True}) OPTIONAL MATCH (g)-[r:AZContains*1..]->(m) RETURN m, r, g"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List all owned users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:AZUser {owned: True}) OPTIONAL MATCH (u)-[r:AZMemberOf|AZHasRole*1..]->(g) WHERE (g:AZRole OR g:AZGroup) AND g.highvalue RETURN u, g, r"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "List groups of all owned users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZUser {owned: True}) OPTIONAL MATCH (m)-[r:AZMemberOf*1..]->(n) RETURN m, r, n"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return All Azure AD Groups that are synchronized with On-Premise AD",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:AZGroup) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n"
        }
      ]
    },
    {
      "name": "Return All Azure Admins and their owned Devices",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(d:AZDevice)<-[r1:AZOwns]->(m:AZUser)<-[r2:AZHasRole]->(n) RETURN p"
        }
      ]
    },
    {
      "name": "Return All Azure Users and their Admin Roles",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n)-[:AZHasRole|AZMemberOf*1..]->(:AZRole) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return All Azure Users and their Groups (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:AZUser)-[r:AZMemberOf|MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p LIMIT 50"
        }
      ]
    },
    {
      "name": "Return All Azure Users and their Groups (Warning: Heavy)",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:AZUser)-[r:AZMemberOf*1..]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p"
        }
      ]
    },
    {
      "name": "Return All Azure Users and their owned Devices (Warning: Heavy)",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(d:AZDevice)<-[r1:AZOwns]->(m:AZUser) RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return All Azure Users that are part of the 'Global Administrator' Role",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN n, p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return All On-Prem users with edges to Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return All Owned Azure Users and their Groups (Limit: 50)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:AZUser {owned: True})-[r:AZMemberOf|MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return Azure Devices with the most edges (Limit: 25)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZDevice)--() WITH m, COUNT(*) AS num ORDER BY num DESC RETURN m LIMIT 25"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return Azure Users with the most edges (Limit: 25)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:AZUser)--() WITH m, COUNT(*) AS num ORDER BY num DESC RETURN m LIMIT 25"
        }
      ]
    },
    {
      "name": "Return GUEST Azure Users and their Groups",
      "category": "Azure",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:AZUser)-[r:AZMemberOf*1..]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' AND m.userprincipalname=~ '(?i).*#EXT#.*' RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Return all owned azure objects",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m {owned: True})-[r {isazure: True}]-() OPTIONAL MATCH (m)-[s:AZMemberOf*1..]->(g:AZGroup {highvalue: True}) RETURN m, g, s"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set Azure roles that can reset password as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n)-[]-(m) WHERE (tolower(n.templateid)) IN ['c4e39bd9-1100-46d3-8c65-fb160da0071f', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', '729827e3-9c14-49f7-bb1b-9608f156bbb8', 'fe930be7-5e62-47db-91af-98c3a49a38b1', '966707d0-3269-4727-9be2-8c3a10f19b9d'] AND  (n.highvalue IS NULL OR NOT n.highvalue) SET n.highvalue=True, n.highvaluereason='Can reset password on Azure' RETURN n"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set Members of High Value Targets Azure Groups as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AZMemberOf*1..]->(g:AZGroup) WHERE g.highvalue = true  AND (a.highvalue IS NULL OR a.highvalue=False)  SET a.highvalue=true, a.highvaluereason='Member of High Value Target Group' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set Privileged Service Principals as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (g:AZServicePrincipal)-[r]->(n) WHERE g.highvalue IS NULL OR g.highvalue=False SET g.highvalue=True, g.highvaluereason='Privileged Service Principal' RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set members with Azure's Gobal Administrator role as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AZGlobalAdmin*1..]->(m) SET a.highvalue=true, a.highvaluereason='Has Azure\\' Global Administrator role' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set owners of Azure Applications as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (n)-[r:AZOwns]->(g:AZApp) WHERE n.highvalue IS NULL OR n.highvalue=False SET n.highvalue=True, n.highvaluereason='Owner of Azure Application' RETURN p"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set owners of Azure VMs as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AZOwns*1..]->(n:AZVM) WHERE n.highvalue IS NULL OR n.highvalue=False SET a.highvalue=true, a.highvaluereason='Owner of an Azure VM' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "Azure",
      "name": "Set principals with permissions in High Value Roles as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AZHasRole*1..]->(g:AZRole) WHERE g.highvalue = true  AND (a.highvalue IS NULL OR a.highvalue=False)  SET a.highvalue=true, a.highvaluereason='Principal with High Value role assigned' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "name": "Find Certificate Authorities",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Enrollment Service' RETURN n"
        }
      ]
    },
    {
      "name": "Find Certificate Authorities with HTTP Web Enrollment (ESC8)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Enrollment Service' and n.`Web Enrollment` = 'Enabled' RETURN n"
        }
      ]
    },
    {
      "name": "Find Certificate Authorities with User Specified SAN (ESC6)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Enrollment Service' and n.`User Specified SAN` = 'Enabled' RETURN n"
        }
      ]
    },
    {
      "name": "Find Enrollment Agent Templates (ESC3)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' and n.`Enabled` = true and (n.`Extended Key Usage` = [] or 'Any Purpose' IN n.`Extended Key Usage` or 'Certificate Request Agent' IN n.`Extended Key Usage`)  RETURN n"
        }
      ]
    },
    {
      "name": "Find Misconfigured Certificate Templates (ESC1)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' and n.`Enrollee Supplies Subject` = true and n.`Client Authentication` = true and n.`Enabled` = true  RETURN n"
        }
      ]
    },
    {
      "name": "Find Misconfigured Certificate Templates (ESC2)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' and n.`Enabled` = true and (n.`Extended Key Usage` = [] or 'Any Purpose' IN n.`Extended Key Usage`)  RETURN n"
        }
      ]
    },
    {
      "name": "Find all Certificate Templates",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' RETURN n"
        }
      ]
    },
    {
      "name": "Find enabled Certificate Templates",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' and n.Enabled = true RETURN n"
        }
      ]
    },
    {
      "name": "Shortest Paths to Enrollment Agent Templates from Owned Principals (ESC3)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Certificate Template' and n.`Enabled` = true and (n.`Extended Key Usage` = [] or 'Any Purpose' IN n.`Extended Key Usage` or 'Certificate Request Agent' IN n.`Extended Key Usage`) return p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Misconfigured Certificate Templates from Owned Principals (ESC1)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Certificate Template' and n.`Enrollee Supplies Subject` = true and n.`Client Authentication` = true and n.`Enabled` = true return p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Misconfigured Certificate Templates from Owned Principals (ESC2)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Certificate Template' and n.`Enabled` = true and (n.`Extended Key Usage` = [] or 'Any Purpose' IN n.`Extended Key Usage`) return p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Vulnerable Certificate Authority Access Control (ESC7)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((g)-[r:GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|ManageCa|ManageCertificates*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Enrollment Service' RETURN p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Vulnerable Certificate Authority Access Control from Owned Principals (ESC7)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Enrollment Service' and NONE(x in relationships(p) WHERE type(x) = 'Enroll' or type(x) = 'AutoEnroll') RETURN p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Vulnerable Certificate Template Access Control (ESC4)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((g)-[:GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner*1..]->(n:GPO)) WHERE  g<>n and n.type = 'Certificate Template' and n.`Enabled` = true RETURN p"
        }
      ]
    },
    {
      "name": "Shortest Paths to Vulnerable Certificate Template Access Control from Owned Principals (ESC4)",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[r*1..]->(n:GPO)) WHERE g<>n and n.type = 'Certificate Template' and n.Enabled = true and NONE(x in relationships(p) WHERE type(x) = 'Enroll' or type(x) = 'AutoEnroll') return p"
        }
      ]
    },
    {
      "name": "Show Enrollment Rights for Certificate Template",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": false,
          "title": "Select a Certificate Template...",
          "query": "MATCH (n:GPO) WHERE n.type = 'Certificate Template' RETURN n.name"
        },
        {
          "final": true,
          "query": "MATCH p=(g)-[:Enroll|AutoEnroll]->(n:GPO {name:$result}) WHERE n.type = 'Certificate Template' return p",
          "allowCollapse": false
        }
      ]
    },
    {
      "name": "Show Rights for Certificate Authority",
      "category": "Certificate Queries",
      "queryList": [
        {
          "final": false,
          "title": "Select a Certificate Authority...",
          "query": "MATCH (n:GPO) WHERE n.type = 'Enrollment Service' RETURN n.name"
        },
        {
          "final": true,
          "query": "MATCH p=(g)-[:ManageCa|ManageCertificates|Auditor|Operator|Read|Enroll]->(n:GPO {name:$result}) return p",
          "allowCollapse": false
        }
      ]
    },
    {
      "category": "Cross-Domain Information",
      "name": "All Users with with Same Name in Different Domains",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u1:User),(u2:User) WHERE split(u1.name,'@')[0] = split(u2.name,'@')[0] AND u1.domain <> u2.domain AND tointeger(split(u1.objectid,'-')[7]) >= 1000 RETURN u1"
        }
      ]
    },
    {
      "category": "Cross-Domain Information",
      "name": "Find OWNED principals that can do something to a foreign object (exclude domain admins)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (da)-[r:MemberOf*1..]->(g:Group) WHERE g.objectid =~ $domain_admins_id OR g.objectid =~ $enterprise_admins_id OR g.objectid =~ $domain_controllers_id OR g.objectid =~ $administrators_id  WITH COLLECT(da) AS exclude MATCH p=allShortestPaths((n {owned: True})-[:MemberOf|HasSession|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|CanRDP|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GPLink|AddAllowedToAct|AllowedToAct|WriteAccountRestrictions|SQLAdmin|ReadGMSAPassword|HasSIDHistory|CanPSRemote|SyncLAPSPassword|DumpSMSAPassword|AZMGGrantRole|AZMGAddSecret|AZMGAddOwner|AZMGAddMember|AZMGGrantAppRoles|AZNodeResourceGroup|AZWebsiteContributor|AZLogicAppContributo|AZAutomationContributor|AZAKSContributor|AZAddMembers|AZAddOwner|AZAddSecret|AZAvereContributor|AZContains|AZContributor|AZExecuteCommand|AZGetCertificates|AZGetKeys|AZGetSecrets|AZGlobalAdmin|AZHasRole|AZManagedIdentity|AZMemberOf|AZOwns|AZPrivilegedAuthAdmin|AZPrivilegedRoleAdmin|AZResetPassword|AZUserAccessAdministrator|AZAppAdmin|AZCloudAppAdmin|AZRunsAs|AZKeyVaultContributor|AZVMAdminLogin|AZVMContributor|AZLogicAppContributor|AddSelf|WriteSPN|AddKeyCredentialLink|DCSync*1..]->(m)) WHERE (n:User OR n:Computer) AND (m:User OR m:Computer OR m:GPO) AND NOT n IN exclude AND NOT n.domain = m.domain RETURN p",
          "props": {
            "domain_admins_id": "S-1-5-.*-512",
            "enterprise_admins_id": "S-1-5-.*-519",
            "domain_controllers_id": "S-1-5-.*-516",
            "administrators_id": ".*-S-1-5-32-544"
          }
        }
      ]
    },
    {
      "name": "Find an object from domain 'A' that can do anything to a foreign object",
      "category": "Cross-Domain Information",
      "requireNodeSelect": true,
      "queryList": [
        {
          "final": false,
          "title": "Select source domain...",
          "query": "MATCH (n:Domain) RETURN n.name ORDER BY n.name"
        },
        {
          "final": true,
          "query": "MATCH p=(n {domain:$result})-[r]->(d) WHERE NOT d.domain=n.domain RETURN p",
          "startNode": "{}",
          "allowCollapse": false
        }
      ]
    },
    {
      "name": "Find an object in one domain that can do something to a foreign object",
      "category": "Cross-Domain Information",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n)-[r]->(m) WHERE NOT n.domain = m.domain RETURN p"
        }
      ]
    },
    {
      "category": "Cross-Domain Information",
      "name": "Find principals that can do something to a foreign object (exclude domain admins)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (da)-[r:MemberOf*1..]->(g:Group) WHERE g.objectid =~ $domain_admins_id OR g.objectid =~ $enterprise_admins_id OR g.objectid =~ $domain_controllers_id OR g.objectid =~ $administrators_id  WITH COLLECT(da) AS exclude MATCH p=allShortestPaths((n)-[:MemberOf|HasSession|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|CanRDP|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GPLink|AddAllowedToAct|AllowedToAct|WriteAccountRestrictions|SQLAdmin|ReadGMSAPassword|HasSIDHistory|CanPSRemote|SyncLAPSPassword|DumpSMSAPassword|AZMGGrantRole|AZMGAddSecret|AZMGAddOwner|AZMGAddMember|AZMGGrantAppRoles|AZNodeResourceGroup|AZWebsiteContributor|AZLogicAppContributo|AZAutomationContributor|AZAKSContributor|AZAddMembers|AZAddOwner|AZAddSecret|AZAvereContributor|AZContains|AZContributor|AZExecuteCommand|AZGetCertificates|AZGetKeys|AZGetSecrets|AZGlobalAdmin|AZHasRole|AZManagedIdentity|AZMemberOf|AZOwns|AZPrivilegedAuthAdmin|AZPrivilegedRoleAdmin|AZResetPassword|AZUserAccessAdministrator|AZAppAdmin|AZCloudAppAdmin|AZRunsAs|AZKeyVaultContributor|AZVMAdminLogin|AZVMContributor|AZLogicAppContributor|AddSelf|WriteSPN|AddKeyCredentialLink|DCSync*1..]->(m)) WHERE (n:User OR n:Computer) AND (m:User OR m:Computer OR m:GPO) AND NOT n IN exclude AND NOT n.domain = m.domain RETURN p",
          "props": {
            "domain_admins_id": "S-1-5-.*-512",
            "enterprise_admins_id": "S-1-5-.*-519",
            "domain_controllers_id": "S-1-5-.*-516",
            "administrators_id": ".*-S-1-5-32-544"
          }
        }
      ]
    },
    {
      "name": "ACL Abuse Opportunities",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n)-[r:WriteDacl|WriteOwner|GenericAll]->(t) WHERE n.highvalue = false AND t.highvalue = true RETURN n.name, TYPE(r), t.name"
        }
      ]
    },
    {
      "category": "Dangerous Rights",
      "name": "All ACLs to Computers (excluding High Value Targets)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (ucg)-[r]->(c:Computer) WHERE (ucg:User OR ucg:Computer OR ucg:Group) AND ucg.highvalue = false AND r.isacl = true RETURN p"
        }
      ]
    },
    {
      "name": "Find Users/Groups with direct access to GPOs",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (n)-[r:AddMember|AddSelf|WriteSPN|AddKeyCredentialLink|AllExtendedRights|ForceChangePassword|GenericAll|GenericWrite|WriteDacl|WriteOwner|Owns]->(g:GPO) RETURN p"
        }
      ]
    },
    {
      "name": "Find all other Rights Domain Users shouldn't have",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:Owns|WriteDacl|GenericAll|WriteOwner|ExecuteDCOM|GenericWrite|AllowedToDelegate|ForceChangePassword]->(n:Computer) WHERE m.objectid ENDS WITH '-513' OR m.objectsid ENDS WITH '-515' OR m.objectsid ENDS WITH 'S-1-5-11' OR m.objectsid ENDS WITH 'S-1-1-0' RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "category": "Dangerous Rights",
      "name": "Find groups that can reset passwords",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:ForceChangePassword]->(n:User) RETURN m"
        }
      ]
    },
    {
      "name": "Find groups that can reset passwords (Warning: Heavy)",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:ForceChangePassword]->(n:User) RETURN p"
        }
      ]
    },
    {
      "name": "Find if any domain user has interesting permissions against a GPO (Warning: Heavy)",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(u:User)-[r:AllExtendedRights|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|GpLink*1..]->(g:GPO) RETURN p"
        }
      ]
    },
    {
      "category": "Dangerous Rights",
      "name": "Find if unprivileged users have rights to add members into groups",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:User {admincount:False}) MATCH p=allShortestPaths((n)-[r:AddMember*1..]->(m:Group)) RETURN p"
        }
      ]
    },
    {
      "name": "Non Admin Groups with High Value Privileges",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(g:Group)-[r:Owns|WriteDacl|GenericAll|WriteOwner|ExecuteDCOM|GenericWrite|AllowedToDelegate|ForceChangePassword]->(n:Computer)  WHERE NOT g.name CONTAINS 'ADMIN' RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Owned users with permissions against GPOs",
      "category": "Dangerous Rights",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(u:User {owned:true})-[r:AllExtendedRights|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|GpLink*1..]->(g:GPO) RETURN p"
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "All Constrained Delegations",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (a)-[:AllowedToDelegate]->(c:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "All RBCD",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (a)-[:AllowedToAct]->(c:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "All Unconstrained Delegation Principals (excluding Domain Controllers and Administrators)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (dca)-[r:MemberOf*0..]->(g:Group) WHERE g.objectid =~ $domain_controllers_id OR g.objectid =~ $administrators_id WITH COLLECT(dca) AS exclude MATCH p = (d:Domain)-[r:Contains*1..]->(uc) WHERE (uc:User OR uc:Computer) AND uc.unconstraineddelegation = true AND NOT uc IN exclude RETURN p",
          "props": {
            "domain_controllers_id": "S-1-5-.*-516",
            "administrators_id": ".*-S-1-5-32-544"
          }
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "Find all computers with Unconstrained Delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer {unconstraineddelegation:true}) return c"
        }
      ]
    },
    {
      "name": "Find computers that allow unconstrained delegation that AREN'T domain controllers.",
      "category": "Delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c1:Computer)-[:MemberOf*1..]->(g:Group) WHERE g.objectid ENDS WITH '-516' WITH COLLECT(c1.name) AS domainControllers MATCH (c2:Computer {unconstraineddelegation:true}) WHERE NOT c2.name IN domainControllers RETURN c2"
        }
      ]
    },
    {
      "name": "Find computers with constrained delegation permissions and the corresponding targets where they allowed to delegate",
      "category": "Delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE c.allowedtodelegate IS NOT NULL RETURN c"
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "Find constrained delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(u:User)-[:AllowedToDelegate]->(c:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Delegation",
      "name": "Find exploitable paths to RBCD (exclude domain admins)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (admins)-[r:MemberOf*0..]->(g:Group) WHERE g.objectid =~ $domain_admins_id OR g.objectid =~ $enterprise_admins_id WITH COLLECT(admins) as exclude MATCH p = (u:User)-[r:MemberOf*0..]->(g:Group)-[r1:GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|AddAllowedToAct|WriteAccountRestrictions]->(c:Computer) WHERE NOT u IN exclude RETURN p",
          "props": {
            "domain_admins_id": "S-1-5-.*-512",
            "enterprise_admins_id": "s-1-5-.*-519"
          }
        }
      ]
    },
    {
      "name": "Shortest paths from owned principals to unconstrained delegation systems",
      "category": "Delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n {owned:true}) MATCH p=shortestPath((n)-[:MemberOf|HasSession|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GpLink|AddAllowedToAct|AllowedToAct|SQLAdmin|ReadGMSAPassword|HasSIDHistory|CanPSRemote*1..]->(m:Computer {unconstraineddelegation: true})) WHERE NOT n=m RETURN p"
        }
      ]
    },
    {
      "category": "Group Hunts",
      "name": "All Domain Groups with Members",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (g:Group) RETURN g"
        }
      ]
    },
    {
      "category": "Group Hunts",
      "name": "Find groups that contain both users and computers",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer)-[r:MemberOf*1..]->(groupsWithComps:Group) WITH groupsWithComps MATCH (u:User)-[r:MemberOf*1..]->(groupsWithComps) RETURN DISTINCT(groupsWithComps) as groupsWithCompsAndUsers"
        }
      ]
    },
    {
      "name": "Groups with Computer and User Objects",
      "category": "Group Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer)-[r:MemberOf*1..]->(groupsWithComps:Group) WITH groupsWithComps MATCH (u:User)-[r:MemberOf*1..]->(groupsWithComps) RETURN DISTINCT(groupsWithComps) as groupsWithCompsAndUsers",
          "allowCollapse": true,
          "endNode": "{}"
        }
      ]
    },
    {
      "name": "Nested Group Analysis",
      "category": "Group Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(u:User)-[:MemberOf*3..]->(g:Group {highvalue:true}) WITH u, g, LENGTH(p) as depth RETURN u.name, g.name, depth ORDER BY depth DESC"
        }
      ]
    },
    {
      "name": "All Owned Nodes",
      "category": "High Value/Owned",
      "queryList": [
        {
          "final": true,
          "requireNodeSelect": false,
          "query": "MATCH (n {owned: true}) RETURN n",
          "allowCollapse": true,
          "props": {}
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Find All edges any owned user has on a computer",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((m:User {owned: True})-[r*]->(b:Computer)) WHERE NOT m=b RETURN p"
        }
      ]
    },
    {
      "name": "Find computers with owned Admins",
      "category": "High Value/Owned",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((n:User {owned:true})-[r:AdminTo|MemberOf*1..]->(c:Computer)) return p",
          "allowCollapse": false
        }
      ]
    },
    {
      "name": "Find owned Domain Admins",
      "category": "High Value/Owned",
      "queryList": [
        {
          "final": true,
          "title": "Select a domain...",
          "query": "MATCH (n:Group) WHERE n.name =~ $name AND n.owned=true WITH n MATCH p=(n)<-[r:MemberOf*1..]-(m) RETURN p",
          "props": {
            "name": "(?i).*DOMAIN ADMINS.*"
          },
          "allowCollapse": false
        }
      ]
    },
    {
      "name": "Groups of High Value Targets",
      "category": "High Value/Owned",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n:User)-[r:MemberOf*1..]->(m:Group {highvalue:true}) RETURN p"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "List all High Valued Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m) WHERE m.highvalue=TRUE RETURN m LIMIT 100"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "List all owned computers",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:Computer {owned: True}) OPTIONAL MATCH (g)-[r:Contains*1..]->(m) RETURN m, r, g"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "List all owned groups",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:Group {owned: True}) OPTIONAL MATCH (g)-[r:Contains*1..]->(m) RETURN m, r, g"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "List all owned users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User {owned: True}) OPTIONAL MATCH (u)-[r:MemberOf*1..]->(g:Group {highvalue: True}) RETURN u, g, r"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "List groups of all owned users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:User {owned: True}) OPTIONAL MATCH (m)-[r:MemberOf*1..]->(n) RETURN m, r, n"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Remove Inactive Users and Computers from High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (uc) WHERE uc.highvalue = true AND ((uc:User AND uc.enabled = false) OR (uc:Computer AND ((uc.enabled = false) OR (uc.lastlogon > 0 AND uc.lastlogon < (TIMESTAMP() / 1000 - 15552000)) OR (uc.lastlogontimestamp > 0 AND uc.lastlogontimestamp < (TIMESTAMP() / 1000 - 15552000))))) SET uc.highvalue = false, uc.nothighvaluereason = 'Inactive' RETURN uc"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set DCSync Principals as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (s)-[r:MemberOf|GetChanges*1..]->(d:Domain) WITH s, d MATCH (s)-[r:MemberOf|GetChangesAll*1..]->(d) WITH s, d MATCH p = (s)-[r:MemberOf|GetChanges|GetChangesAll*1..]->(d) SET s.highvalue = true, s.highvaluereason = 'DCSync Principal' RETURN p LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set Local Admin or Reset Password Principals as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AdminTo|ForceChangePassword]->(b) SET a.highvalue = true, a.highvaluereason = 'Local Admin or Reset Password Principal' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set Members of High Value Targets Groups as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:MemberOf*1..]->(g:Group) WHERE g.highvalue = true SET a.highvalue=true, a.highvaluereason='Member of High Value Target Group' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set Principals with Privileges on Computers as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AllowedToDelegate|ExecuteDCOM|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner]->(n:Computer) SET a.highvalue = true, a.highvaluereason = 'Principal with Privileges on Computers' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set Principals with Privileges on GPOs as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AllExtendedRights|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|GpLink*1..]->(g:GPO) SET a.highvalue = true, a.highvaluereason = 'Principal with Privileges on GPOs' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set RBCD Principals as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (a)-[r:AllowedToAct]->(c:Computer) SET a.highvalue = true, a.highvaluereason = 'RBCD Principal' RETURN a LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Set Unconstrained Delegation Principals as High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(uc) WHERE (uc:User OR uc:Computer) AND uc.unconstraineddelegation = true SET uc.highvalue = true, uc.highvaluereason = 'Unconstrained Delegation Principal' RETURN p LIMIT 50"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "Show all high value target's groups",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(n:User)-[r:MemberOf*1..]->(m) WHERE (m:Group OR m:AZGroup) AND m.highvalue RETURN p"
        }
      ]
    },
    {
      "category": "High Value/Owned",
      "name": "View all GPOs",
      "queryList": [
        {
          "final": true,
          "query": "Match (n:GPO) RETURN n"
        }
      ]
    },
    {
      "name": "All Kerberoastable Users",
      "category": "Kerberos",
      "queryList": [
        {
          "final": true,
          "requireNodeSelect": false,
          "query": "MATCH (n {hasspn: true}) RETURN n",
          "allowCollapse": true,
          "props": {}
        }
      ]
    },
    {
      "name": "Find All Users with an SPN/Find all Kerberoastable Users with passwords last set less than 5 years ago",
      "category": "Kerberos",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.hasspn=true AND u.pwdlastset < (datetime().epochseconds - (1825 * 86400)) AND NOT u.pwdlastset IN [-1.0, 0.0] RETURN u.name, u.pwdlastset order by u.pwdlastset "
        }
      ]
    },
    {
      "category": "Kerberos",
      "name": "Find Kerberoastable Users with a path to DA",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User {hasspn:true}) MATCH (g:Group) WHERE g.objectid ENDS WITH '-512' MATCH p = allShortestPaths( (u)-[*1..]->(g) ) RETURN p"
        }
      ]
    },
    {
      "name": "Find Kerberoastable users and where they are AdminTo",
      "category": "Kerberos",
      "queryList": [
        {
          "final": true,
          "query": "OPTIONAL MATCH (u1:User) WHERE u1.hasspn=true OPTIONAL MATCH (u1)-[r:AdminTo]->(c:Computer) RETURN u1"
        }
      ]
    },
    {
      "name": "Find Kerberoastable users who are members of high value groups",
      "category": "Kerberos",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User)-[r:MemberOf*1..]->(g:Group) WHERE g.highvalue=true AND u.hasspn=true RETURN u"
        }
      ]
    },
    {
      "category": "Kerberos",
      "name": "Find all Kerberoastable Users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:User)WHERE n.hasspn=true RETURN n",
          "allowCollapse": false
        }
      ]
    },
    {
      "category": "Kerberos",
      "name": "Find users that can be AS-REP roasted",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User {dontreqpreauth: true}) RETURN u"
        }
      ]
    },
    {
      "name": "Kerberoastable Admins",
      "category": "Kerberos",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:Group) WHERE n.objectsid =~ $sid WITH n MATCH p=(n)<-[MemberOf*1..]-(m {hasspn: true}) RETURN p",
          "allowCollapse": true,
          "props": {
            "sid": "(?i)S-1-5-.*-512"
          }
        }
      ]
    },
    {
      "category": "Keywords",
      "name": " Return the name of every computer in the database where at least one SPN for the computer contains the string 'JENKINS'",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE ANY (x IN c.serviceprincipalnames WHERE x =~ '(?i).*jenkins.*') RETURN c"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": " Return the name of every computer in the database where at least one SPN for the computer contains the string 'JIRA'",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE ANY (x IN c.serviceprincipalnames WHERE x =~ '(?i).*jira.*') RETURN c"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": " Return the name of every computer in the database where at least one SPN for the computer contains the string 'MSSQL'",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE ANY (x IN c.serviceprincipalnames WHERE x =~ '(?i).*MSSQL.*') RETURN c"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "All Principals with '<password-like string>' in AD Description",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u) WHERE u.description =~ '(?=.*?[A-Za-z])(?=.*?[0-9])(?=.*?[^\\\\w\\\\s]).{6,}' RETURN u"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "All Principals with 'BACKUP' in AD Description",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u) WHERE u.description =~ '(?i).*backup.*' RETURN u"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "All Principals with 'LOGIN' in AD Description",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u) WHERE u.description =~ '(?i).*login.*' RETURN u"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "All Principals with 'PASS' in AD Description",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u) WHERE u.description =~ '(?i).*pass.*' RETURN u"
        }
      ]
    },
    {
      "name": "All enabled computers with a description containing the word file",
      "category": "Keywords",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(c:Computer) WHERE c.description =~ '(?i).*file.*' RETURN p"
        }
      ]
    },
    {
      "name": "Find users with 'Temp' in user title and created in the last 30 days",
      "category": "Keywords",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) where u.enabled=TRUE and u.whencreated  > (datetime().epochseconds - (30 * 86400)) AND u.title CONTAINS 'Temp' RETURN u"
        }
      ]
    },
    {
      "name": "Find users with 'password' in AD description fields",
      "category": "Keywords",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m:User) WHERE m.description CONTAINS 'password' RETURN m.name, m.description"
        }
      ]
    },
    {
      "name": "Locate enabled accounts with display name of 'admin'",
      "category": "Keywords",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(u:User) WHERE u.displayname =~ '(?i).*admin*' AND u.enabled = true RETURN p"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "View all groups that contain the word 'ADM'",
      "queryList": [
        {
          "final": true,
          "query": "Match (n) WHERE (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*adm.*' OR n.azname =~ '(?i).*adm.*')  RETURN n"
        }
      ]
    },
    {
      "name": "View all groups that contain the word 'admin'",
      "category": "Keywords",
      "queryList": [
        {
          "final": true,
          "query": "Match (n:Group) WHERE n.name CONTAINS 'ADMIN' RETURN n"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "View all users or groups that contain 'JENKINS' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m) WHERE  (m:User OR m:Groupo OR m:AZUser OR m:AZGroup) AND  (m.name =~ '(?i).*jenkins.*' OR m.azname =~ '(?i).*jenkins.*') RETURN m"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "View all users that contain the word 'ADM'",
      "queryList": [
        {
          "final": true,
          "query": "Match (n) WHERE (n:User OR n:AZUser) AND (n.name =~ '(?i).*adm.*' OR n.azname =~ '(?i).*adm.*')  RETURN n"
        }
      ]
    },
    {
      "category": "Keywords",
      "name": "View all users that contain the words 'SERVICE' or 'SVC'",
      "queryList": [
        {
          "final": true,
          "query": "Match (n) WHERE (n:User OR n:AZUser) AND (n.name =~ '(?i).*(service|svc).*' OR n.azname =~ '(?i).*(service|svc).*')  RETURN n"
        }
      ]
    },
    {
      "category": "LAPS",
      "name": "All Computers with LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE c.haslaps = true RETURN c"
        }
      ]
    },
    {
      "category": "LAPS",
      "name": "All Computers without LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) WHERE c.haslaps = false RETURN c"
        }
      ]
    },
    {
      "name": "All Computers without LAPS - with session",
      "category": "LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(c:Computer)-[:HasSession]->(y) WHERE c.haslaps = false RETURN p"
        }
      ]
    },
    {
      "category": "LAPS",
      "name": "All Principals that can sync LAPS passwords (excluding Domain Admins)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (adm)-[MemberOf*1..]->(g:Group) WHERE g.objectid =~ $domain_admins_id OR g.objectid =~ $enterprise_admins_id OR g.objectid =~ $domain_controllers_id WITH COLLECT(adm) AS exclude MATCH p = (u)-[r:SyncLAPSPassword|MemberOf*1..]->(c) WHERE NOT u IN exclude RETURN p",
          "props": {
            "domain_admins_id": "S-1-5-.*-512",
            "enterprise_admins_id": "S-1-5-.*-519",
            "domain_controllers_id": "S-1-5-.*-516"
          }
        }
      ]
    },
    {
      "category": "LAPS",
      "name": "All Users that can read LAPS passwords (excluding Domain Admins)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (adm)-[MemberOf*1..]->(g:Group) WHERE g.objectid =~ $domain_admins_id OR g.objectid =~ $enterprise_admins_id OR g.objectid =~ $domain_controllers_id WITH COLLECT(adm) AS exclude MATCH p = (u:User)-[r:ReadLAPSPassword|MemberOf*1..]->(c:Computer) WHERE NOT u IN exclude RETURN p",
          "props": {
            "domain_admins_id": "S-1-5-.*-512",
            "enterprise_admins_id": "S-1-5-.*-519",
            "domain_controllers_id": "S-1-5-.*-516"
          }
        }
      ]
    },
    {
      "name": "All computers without LAPS and the computer is enabled",
      "category": "LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(c:Computer) WHERE c.haslaps = false AND c.enabled = true RETURN p"
        }
      ]
    },
    {
      "name": "LAPS Deployment Gap Analysis",
      "category": "LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (ou:OU)-[:Contains]->(c:Computer) WHERE c.enabled = true AND c.haslaps = false WITH ou, COUNT(c) as computers_without_laps RETURN ou.name, computers_without_laps ORDER BY computers_without_laps DESC"
        }
      ]
    },
    {
      "name": "Find Server 2000 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2000).*' AND H.enabled = TRUE RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2000 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2000).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2003 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2003).*' AND H.enabled = TRUE RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2003 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2003).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2008 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2008).*' AND H.enabled = TRUE RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2008 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2008).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2012 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2012).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2012 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2012).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2016 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2016).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2016 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2016).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2019 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2019).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2019 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2019).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2022 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(2022).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Server 2022 with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(2022).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Un-Supported OS and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:Computer) WHERE n.operatingsystem =~ '(?i).*(2000|2003|2008|xp|vista|7|me).*' AND n.enabled = true RETURN n"
        }
      ]
    },
    {
      "name": "Find Windows 7 and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(7).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Windows 7 session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(7).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find Windows XP and Enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem =~ '(?i).*(xp).*' AND H.enabled = true RETURN H"
        }
      ]
    },
    {
      "name": "Find Windows XP with session",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer)-[:HasSession]->(y) WHERE H.operatingsystem =~ '(?i).*(xp).*' RETURN H"
        }
      ]
    },
    {
      "category": "OS Finder",
      "name": "Find all computers with unsupported operating systems",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem = '.*(2000|2003|2008|xp|vista|7|me).*' RETURN H"
        }
      ]
    },
    {
      "name": "Find all computers with unsupported operating systems - and enabled",
      "category": "OS Finder",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (H:Computer) WHERE H.operatingsystem = '.*(2000|2003|2008|xp|vista|7|me).*' AND H.enabled = TRUE RETURN H"
        }
      ]
    },
    {
      "category": "PSRemote",
      "name": "Find all computers we can PSRemote into from owned constrained delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m {owned: True})-[:AllowedToDelegate]->(c:Computer) WITH COLLECT(c) AS targets MATCH p=(u:User)-[r:CanPSRemote|MemberOf*1..]->(n:Computer) WHERE n IN targets RETURN p UNION ALL MATCH p  = (m {owned: True})-[:AllowedToDelegate]->(c:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "PSRemote",
      "name": "Find all users that can PSRemote into a given computer",
      "requireNodeSelect": true,
      "queryList": [
        {
          "final": false,
          "title": "Select computer...",
          "query": "MATCH (c:Computer) RETURN c.name ORDER BY c.name"
        },
        {
          "final": true,
          "query": "MATCH p=(m:User)-[r:CanPSRemote|MemberOf*1..]->(n:Computer {name:$result}) RETURN p",
          "startNode": "{}",
          "allowCollapse": false
        }
      ]
    },
    {
      "category": "PSRemote",
      "name": "Find machines Domain Users can PSRemote into",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = shortestPath((u:User)-[r:CanPSRemote|MemberOf*1..]->(g:Computer)) WHERE NOT u = g RETURN p"
        }
      ]
    },
    {
      "category": "PSRemote",
      "name": "Find machines OWNED Principals can PSRemote into",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m {owned: True})-[r:CanPSRemote]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "PSRemote",
      "name": "Find what GROUPS can PSRemote",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:CanPSRemote]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Password Hunts",
      "name": "All Users with Password not Required",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.passwordnotreqd = true RETURN u"
        }
      ]
    },
    {
      "name": "Find all users with passwords set over 1440 days ago (47 months)",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.enabled=true AND u.pwdlastset < (datetime().epochseconds - (1440 * 86400)) and NOT u.pwdlastset IN [-1.0, 0.0] RETURN u"
        }
      ]
    },
    {
      "name": "Find all users with passwords set over 720 days ago (23 months)",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.enabled=true AND u.pwdlastset < (datetime().epochseconds - (720 * 86400)) and NOT u.pwdlastset IN [-1.0, 0.0] RETURN u"
        }
      ]
    },
    {
      "name": "Find users created in the last 30 days",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) where u.enabled=TRUE and u.whencreated  > (datetime().epochseconds - (30 * 86400)) RETURN u"
        }
      ]
    },
    {
      "name": "Find users that have never logged on and account is still active",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:User) WHERE n.lastlogontimestamp=-1.0 AND n.enabled=TRUE RETURN n "
        }
      ]
    },
    {
      "name": "Find users that haven't logged on in 720 days and account is still active",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n:User) WHERE n.lastlogontimestamp < (datetime().epochseconds - (720 * 86400)) AND n.enabled=TRUE RETURN n "
        }
      ]
    },
    {
      "name": "Find users that logged in within the last 90 days",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.lastlogon < (datetime().epochseconds - (90 * 86400)) and NOT u.lastlogon IN [-1.0, 0.0] RETURN u"
        }
      ]
    },
    {
      "name": "Find users with blank passwords that are enabled",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE NOT u.userpassword IS null AND u.enabled = TRUE RETURN u.name,u.userpassword"
        }
      ]
    },
    {
      "name": "Find users with passwords last set within the last 90 days",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) WHERE u.pwdlastset < (datetime().epochseconds - (90 * 86400)) and NOT u.pwdlastset IN [-1.0, 0.0] RETURN u"
        }
      ]
    },
    {
      "name": "Return users with a variant of \"password\" in their password and a path to high value targets (limit to 25 results)",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "match (u1:User) WHERE u1.plaintextpassword =~ \"(.*[pP][aA@][sS$][sS$][wW][oO0][rR][dD].*)\"  MATCH p=shortestPath((u1:User)-[*1..]->(n {highvalue:true})) WHERE  u1<>n return u1 LIMIT 25",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Return users with a variant of \"password\" in their password and are high value targets",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u1:User) WHERE u1.plaintextpassword =~ \"(.*[pP][aA@][sS$][sS$][wW][oO0][rR][dD].*)\" MATCH p=(u1:User)-[r:MemberOf*1..]->(m:Group {highvalue:true}) RETURN u1",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Return users with a variant of \"password\" in their password and have local admin on at least one computer",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "match (u1:User) WHERE u1.plaintextpassword =~ \"(.*[pP][aA@][sS$][sS$][wW][oO0][rR][dD].*)\" match p=(u1:User)-[r:AdminTo]->(n:Computer) RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Return users with seasons in their password and a path to high value targets (limit to 25 results)",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "match (u1:User) WHERE u1.plaintextpassword =~ \"([Ww]inter.*|[sS]pring.*|[sS]ummer.*|[fF]all.*)\" MATCH p=shortestPath((u1:User)-[*1..]->(n {highvalue:true})) WHERE  u1<>n return u1 LIMIT 25",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Return users with seasons in their password and are high value targets",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u1:User) WHERE u1.plaintextpassword =~ \"([Ww]inter.*|[sS]pring.*|[sS]ummer.*|[fF]all.*)\" MATCH p=(u1:User)-[r:MemberOf*1..]->(m:Group {highvalue:true}) RETURN u1",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Return users with seasons in their password and have local admin on at least one computer",
      "category": "Password Hunts",
      "queryList": [
        {
          "final": true,
          "query": "match (u1:User) WHERE u1.plaintextpassword =~ \"([Ww]inter.*|[sS]pring.*|[sS]ummer.*|[fF]all.*)\" match p=(u1:User)-[r:AdminTo]->(n:Computer) RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "category": "RDP",
      "name": "Find all computers we can RDP into from owned constrained delegation",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (m {owned: True})-[:AllowedToDelegate]->(c:Computer) WITH COLLECT(c) AS targets MATCH p=(u:User)-[r:CanRDP|MemberOf*1..]->(n:Computer) WHERE n IN targets RETURN p UNION ALL MATCH p  = (m {owned: True})-[:AllowedToDelegate]->(c:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "RDP",
      "name": "Find all users that can RDP into a given computer",
      "requireNodeSelect": true,
      "queryList": [
        {
          "final": false,
          "title": "Select computer...",
          "query": "MATCH (c:Computer) RETURN c.name ORDER BY c.name"
        },
        {
          "final": true,
          "query": "MATCH p=(m:User)-[r:CanRDP|MemberOf*1..]->(n:Computer {name:$result}) RETURN p",
          "startNode": "{}",
          "allowCollapse": false
        }
      ]
    },
    {
      "category": "RDP",
      "name": "Find machines Domain Users can RDP into",
      "queryList": [
        {
          "final": true,
          "query": "match p=(g:Group)-[:CanRDP]->(c:Computer) where g.objectid ENDS WITH '-513' return p"
        }
      ]
    },
    {
      "category": "RDP",
      "name": "Find machines OWNED Users can RDP into",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:CanRDP]->(n:Computer) WHERE m.owned=TRUE RETURN p"
        }
      ]
    },
    {
      "category": "RDP",
      "name": "Find what GROUPS can RDP",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:CanRDP]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "name": "Find what groups can RDP",
      "category": "RDP",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m:Group)-[r:CanRDP]->(n:Computer) RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Kerberoastable Users to Computers",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((u:User)-[r:{}*1..]->(c:Computer)) WHERE u.hasspn = true RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Kerberoastable Users to High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((u:User)-[r:{}*1..]->(h)) WHERE u.hasspn = true AND h.highvalue = true RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Owned Principals (including everything)",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((u {owned: True})-[r:{}*1..]->(a)) WHERE NOT u=a AND (a:Domain OR a:AZTenant OR a.highvalue)RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Owned Principals to Domain",
      "queryList": [
        {
          "final": false,
          "title": "Select a Domain...",
          "query": "MATCH (d:Domain) RETURN d.name ORDER BY d.name ASC"
        },
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((o)-[r:{}*1..]->(d:Domain)) WHERE o <> d AND o.owned = true AND d.name = $result RETURN p",
          "endNode": "{}"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Owned Principals to High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((o)-[r:{}*1..]->(h)) WHERE o <> h AND o.owned = true AND h.highvalue = true RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from Owned Principals to no LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((o)-[r:{}*1..]->(c:Computer)) WHERE NOT o = c AND o.owned = true AND c.haslaps = false RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from no Signing to Domain",
      "queryList": [
        {
          "final": false,
          "title": "Select a Domain...",
          "query": "MATCH (d:Domain) RETURN d.name ORDER BY d.name ASC"
        },
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((c:Computer)-[r:{}*1..]->(d:Domain)) WHERE c.hassigning = false AND d.name = $result RETURN p",
          "endNode": "{}"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths from no Signing to High Value Targets",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((c:Computer)-[r:{}*1..]->(h)) WHERE NOT c = h AND c.hassigning = false AND h.highvalue = true RETURN p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths to Azure Tenant",
      "queryList": [
        {
          "final": false,
          "title": "Select a Tenant...",
          "query": "MATCH (d:AZTenant) RETURN d.name ORDER BY d.name ASC"
        },
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((uc)-[r:{}*1..]->(d:AZTenant {name: $result})) WHERE NOT uc=d RETURN p",
          "endNode": "{}"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths to Domain (including Computers)",
      "queryList": [
        {
          "final": false,
          "title": "Select a Domain...",
          "query": "MATCH (d:Domain) RETURN d.name ORDER BY d.name ASC"
        },
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((uc)-[r:{}*1..]->(d:Domain {name: $result})) WHERE (uc:User OR uc:Computer) RETURN p",
          "endNode": "{}"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "All Shortest Paths to no LAPS",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = allShortestPaths((uc)-[r:{}*1..]->(c:Computer)) WHERE (uc:User OR uc:Computer) AND NOT uc = c AND c.haslaps = false RETURN p"
        }
      ]
    },
    {
      "name": "Cross-Domain Attack Paths",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((s {owned:true})-[:MemberOf|HasSession|AdminTo|TrustedBy|DCSync|AllExtendedRights|Contains|GPLink|GenericAll|GenericWrite|WriteDacl|WriteOwner*1..10]->(t {highvalue:true})) WHERE s.domain <> t.domain RETURN p"
        }
      ]
    },
    {
      "name": "Find Shortest Path from owned Node to Domain Admin",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": false,
          "title": "Select a Domain Admin group...",
          "query": "MATCH (n:Group) WHERE n.name =~ $name RETURN n.name ORDER BY n.name DESC",
          "props": {
            "name": "(?i).*DOMAIN ADMINS.*"
          }
        },
        {
          "final": true,
          "query": "MATCH (n:User),(m:Group {name:$result}),p=shortestPath((n {owned:true})-[r:MemberOf|AdminTo|HasSession|Contains|GpLink|Owns|DCSync|AllExtendedRights|ForceChangePassword|GenericAll|GenericWrite|WriteDacl|WriteOwner*1..]->(m)) RETURN p",
          "allowCollapse": true,
          "endNode": "{}"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "Find the Shortest path to a high value target from an owned object",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((g {owned:true})-[*1..]->(n {highvalue:true})) WHERE  g<>n return p"
        }
      ]
    },
    {
      "category": "Shortest Paths",
      "name": "Find the Shortest path to a unconstrained delegation system from an owned object",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n) MATCH p=shortestPath((n)-[*1..]->(m:Computer {unconstraineddelegation: true})) WHERE NOT n=m AND n.owned = true RETURN p"
        }
      ]
    },
    {
      "name": "Most exploitable paths from owned objects to High Value Targets (5 hops)",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=allShortestPaths((n {owned:true})-[:MemberOf|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GpLink|AddAllowedToAct|AllowedToAct|SQLAdmin|ReadGMSAPassword|HasSIDHistory*1..5]->(m {highvalue:true})) WHERE NOT n=m RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "name": "Next steps (3 hops) from owned objects",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((c {owned: true})-[*1..3]->(s)) WHERE NOT c = s RETURN p"
        }
      ]
    },
    {
      "name": "Next steps (5 hops) from owned objects",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((c {owned: true})-[*1..5]->(s)) WHERE NOT c = s RETURN p"
        }
      ]
    },
    {
      "name": "Shortest paths from owned objects to High Value Targets (5 hops)",
      "category": "Shortest Paths",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=shortestPath((n {owned:true})-[:MemberOf|HasSession|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|CanRDP|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GpLink|AddAllowedToAct|AllowedToAct|SQLAdmin|ReadGMSAPassword|HasSIDHistory|CanPSRemote*1..5]->(m {highvalue:true})) WHERE NOT n=m RETURN p",
          "allowCollapse": true
        }
      ]
    },
    {
      "category": "User Information",
      "name": "All Domain Computers",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (c:Computer) RETURN c"
        }
      ]
    },
    {
      "category": "User Information",
      "name": "All Domain Users",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User) RETURN u"
        }
      ]
    },
    {
      "name": "All Users with a homedirectory",
      "category": "User Information",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(u:User) WHERE u.homedirectory =~ '(?i).*.*' RETURN p"
        }
      ]
    },
    {
      "name": "All enabled computers with a description",
      "category": "User Information",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p = (d:Domain)-[r:Contains*1..]->(c:Computer) WHERE c.description =~ '(?i).*.*' RETURN p"
        }
      ]
    },
    {
      "name": "Find all sessions a user in a specific domain has",
      "category": "User Information",
      "requireNodeSelect": true,
      "queryList": [
        {
          "final": false,
          "title": "Select source domain...",
          "query": "MATCH (n:Domain) RETURN n.name ORDER BY n.name"
        },
        {
          "final": true,
          "query": "MATCH p=(m:Computer)-[r:HasSession]->(n:User {domain:$result}) RETURN p",
          "startNode": "{}",
          "allowCollapse": false
        }
      ]
    },
    {
      "name": "Stale Accounts",
      "category": "User Information",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (u:User)-[:MemberOf*1..]->(g:Group) WHERE g.highvalue = true AND u.enabled = true AND u.lastlogon < (datetime().epochseconds - (90 * 86400)) AND NOT u.lastlogon IN [-1.0, 0.0] RETURN u.name, u.lastlogon, g.name ORDER BY u.lastlogon"
        }
      ]
    },
    {
      "category": "VPN",
      "name": "Find all GROUPS that are members of groups containing 'VPN' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m)-[MemberOf*1..]-(n) WHERE (m:Group OR m:AZGroup) AND (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*vpn.*' OR n.azname =~ '(?i).*vpn.*') RETURN p"
        }
      ]
    },
    {
      "category": "VPN",
      "name": "Find all GROUPS that contain 'VPN' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH (n) WHERE (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*vpn.*' OR n.azname =~ '(?i).*vpn.*') RETURN n"
        }
      ]
    },
    {
      "category": "VPN",
      "name": "Find all USERS that are members of groups containing 'VPN' in their names",
      "queryList": [
        {
          "final": true,
          "query": "MATCH p=(m)-[MemberOf]->(n) WHERE (m:User OR m:AZUser) AND (n:Group OR n:AZGroup) AND (n.name =~ '(?i).*vpn.*' OR n.azname =~ '(?i).*vpn.*') RETURN p"
        }
      ]
    },
    {
      "name": "Find all users a part of the VPN group",
      "category": "VPN",
      "queryList": [
        {
          "final": true,
          "query": "Match p=(u:User)-[:MemberOf]->(g:Group) WHERE toUPPER (g.name) CONTAINS 'VPN' return p"
        }
      ]
    }
  ]
}
